---
title: 第 1 部分面试题
description: 第 1 部分面试题
---

## Redis 不同持久化机制的区别

### RDB 与 AOF

Redis 有两种持久化机制，分别是 `RDB` 与 `AOF`。

- RDB（Redis DataBase）持久化
    - 在指定的时间间隔内将内存中的数据集快照写入磁盘（point-in-time snapshot）。在 Redis 运行时，RDB 程序将当前内存中的数据集快照保存到磁盘文件中，在 Redis 重启动时，RDB 程序可以通过载入 RDB 文件来还原数据库的状态。
    - Redis 会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。在整个过程中，主进程是不进行任何操作的，这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那 RDB 方式要比 AOF 方式更加高效。

- AOF（Append Only File）持久化
    - 以日志的形式来记录每个写操作，将 Redis 执行过的所有写指令记录下来（读操作不记录），同时只许追加文件不能改写文件。当 Redis 重新启时，程序就可以通过重新执行 AOF 文件中的写指令来达到重建数据集的目的。
    - Rewrite (重写) 机制
        - AOF 采用文件追加方式进行持久化，为了避免日志文件出现越来越大的情况，额外新增了重写机制。也就是当 AOF 文件的大小超过所设定的阀值时，Redis 就会启动 AOF 文件的内容压缩，只保留可以恢复数据的最小指令集。`bgrewriteaof` 命令可以执行重写操作。
    - AOF 同步频率设置
        - 始终同步，每次 Redis 的写入都会立刻记入日志。
        - 每秒同步，每秒记入日志一次，如果 Redis 宕机，本秒的数据可能会丢失。
        - 不主动进行同步，将同步时机交给操作系统。

### RDB 的优缺点

- RDB 的优点
  - 节省磁盘空间
  - 数据恢复速度快

- RDB 的缺点
  - 在一定的时间间隔做一次备份，如果 Redis 以为 down 掉的话，那么最后一次快照（持久化）后的数据可能会丢失
  - 虽然 Redis 在 fork 时使用了写时拷贝技术，但是如果数据量较大时，比较耗性能，可能会导致 Redis 在数毫秒或者几秒内不能响应客户端的请求

### AOF 的优缺点

- AOF 的优点
  - 备份机制更稳健，丢失数据的概率更低
  - 可读的日志文本，操作 AOF 比较稳健，可以处理误操作

- AOF 的缺点
  - 数据恢复速度较慢
  - 对于相同的数据集来说，与 RDB 比较，占用更多的磁盘空间
  - 若同步策略为每次写入都同步的话，有一定的性能压力，尤其是处理巨大的写入时

## Redis 五大数据类型的应用场景

Redis 支持的键值数据类型包括：字符串类型、散列类型、列表类型、集合类型、有序集合类型。

| 数据类型   | 常用操作命令                     | 应用场景                                                               |
| ---------- | -------------------------------- | ---------------------------------------------------------------------- |
| String     | get、SET、incr、decr、mget       | 常规的 key-value 缓存应用：IP 屏蔽；常规计数: 微博数、粉丝数           |
| Hash       | hget、hSET、hgetall              | 存储部分频繁变更的数据，如用户信息等                                   |
| List       | LPUSH、rpush、lpop、rpop、lrange | Twitter 的关注列表，微博粉丝列表，最新消息排行榜，作为栈、消息队列使用 |
| SET        | sadd、spop、smembers、sunion     | 求差集、交集、并集，例如：微博的共同关注、共同喜好、二度好友等功能     |
| Sorted SET | zadd、zrange、zrem、zcard        | 商品的综合排名、价格排名、优先级队列                                   |
